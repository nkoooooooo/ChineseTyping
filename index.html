<!DOCTYPE html>
<html lang="zh-HK">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>打字練習列表 - 中文打字平台</title>
  <!-- 引入Bootstrap 5 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- 添加自定义样式 -->
  <style>
    .sticky-top {
      z-index: 1020;
    }

    .table-wrap {
      overflow-x: auto;
    }

    footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      text-align: center;
      padding: 10px 0;
      font-size: 0.9em;
      background: #f1f1f1;
      color: #888;
    }
  </style>
</head>

<body>

  <!-- Sticky Navbar 上方的导航栏 -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">中文打字平台</a>
      <span class="navbar-text ms-auto" id="username">用戶名稱</span>
      <button class="btn btn-outline-warning ms-3" onclick="logout()">登出</button>
    </div>
  </nav>

  <!-- 打型練習列表 -->
  <section class="ftco-section">
    <div class="container">
      <div class="row justify-content-center mb-5">
        <div class="col-md-6 text-center">
          <h2 class="heading-section">打字練習列表</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="table-wrap">
            <table class="table">
              <thead class="table-dark">
                <tr>
                  <th>項目</th>
                  <th>題目</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <!-- 這裡將動態生成打字練習項目 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>Copyright © SKHTKPSS. All rights reserved. Powered by NKO</p>
  </footer>

  <!-- Bootstrap 5 JS 和 Popper.js -->
  <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
    integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 自定义JavaScript -->
  <script>
    function checkLoginStatus() {
      // 檢查用戶是否已登入，未登入的話重定向到登入頁面
      const isLoggedIn = getCookie('isLogin');
      if (isLoggedIn) {
        // 显示用户名
        if (getCookie('username')) {
          document.getElementById('username').textContent = getCookie('username');
        }
      } else {
        window.location.href = 'login.html';
      }
    }

    window.onload = function () {
      checkLoginStatus();
    }

    // 登出操作
    function logout() {
      // 清除所有cookie信息
      document.cookie = "email=; Max-Age=-99999999; path=/";
      document.cookie = "username=; Max-Age=-99999999; path=/";
      document.cookie = "isLogin=; Max-Age=-99999999; path=/";
      // 重定向回登录界面
      window.location.href = 'login.html';
    }


    // 辅助函数：从cookie中读取登录用户名
    function getCookie(name) {
      let cookieArray = document.cookie.split(';');
      for (let i = 0; i < cookieArray.length; i++) {
        let cookiePair = cookieArray[i].split('=');
        if (name == cookiePair[0].trim()) {
          return decodeURIComponent(cookiePair[1]);
        }
      }
      return null;
    }

    // 聲明一個函數用於更新表格內容
    function updateExerciseTable(exercises) {
      const tableBody = document.querySelector('.table tbody');
      tableBody.innerHTML = ''; // 清空现有内容

      exercises.forEach((exercise) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <th scope="row">${exercise.id}</th>
          <td>${exercise.title}</td>
          <td>未開始</td>
          <td>
            <a href="#" class="btn btn-primary">開始練習</a>
          </td>
        `;
        tableBody.appendChild(row);
        // 找到开始练习的按钮并添加点击事件
        const startButton = row.querySelector('.btn-primary');
        startButton.setAttribute('href', `exercise.html?id=${exercise.id}`);
      });
    }

    // 使用fetch API從遠端URL加載數據
    fetch('https://raw.githubusercontent.com/nkoooooooo/ChineseTyping/main/exercise.json')
      .then(response => response.json()) // 解析返回的JSON數據
      .then(data => {
        updateExerciseTable(data); // 使用數據更新表格
      })
      .catch(error => {
        // 處理錯誤
        console.error('Fetch error:', error);
      });

  </script>
</body>

</html>